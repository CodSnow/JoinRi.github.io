<html>
<head>
  <title>Zookeeper</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
    <link rel="stylesheet" type="text/css" href="../css/main.css" /> 
</head>
<body>
<h1>目录</h1>
<ul id="menu">
<li><a href="../notes/Saprk.html">Saprk</a></li>
<li><a href="../notes/HDFS.html">HDFS</a></li>
<li><a href="../notes/Flume.html">Flume</a></li>
<li><a href="../notes/Yarn.html">Yarn</a></li>
<li><a href="../notes/Zookeeper.html">Zookeeper</a></li>
<li><a href="../notes/HBase--分布式数据库.html">HBase</a></li>
<li><a href="../notes/Hive.html">Hive</a></li>
<li><a href="../notes/Loader.html">Loader</a></li>
<li><a href="../notes/Kafka.html">Kafka</a></li>
<li><a href="../notes/Flink.html">Flink</a></li>
</ul>
<br><br><br><br><br>
<a name="483"/>
<h1>Zookeeper</h1>

<div>
<span><div><div><div><div><div><font style="font-size: 14pt;"><span style="color: black; font-family: 华文细黑; font-size: 14pt; font-weight: bold;">本章节主要介绍知识点有：</span></font></div><ul><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 12pt; color: black; font-family: 华文细黑;">的作用以及在华为产品中的位置。</span></font></div></li><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 12pt; color: black; font-family: 华文细黑;">的服务架构以及数据模型。</span></font></div></li><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 12pt; color: black; font-family: 华文细黑;">的读写特性以及一致性的保证。</span></font></div></li><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 12pt; color: black; font-family: 华文细黑;">节点的创建以及节点权限设定。</span></font></div></li><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 12pt; color: black; font-family: 华文细黑;">与组件之间的关系。</span></font></div></li></ul><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-weight: bold;"><font style="font-size: 16pt;">简介</font></span></div><div>    ZooKeeper是一个分布式、高可用性的协调服务。在华为大数据产品中主要提供两个功能：</div><ul><li><div>帮助系统避免单点故障，建立可靠的应用程序。</div></li><li><div>提供分布式协作服务和维护配置信息</div></li></ul><div><br/></div><div><span style="font-weight: bold; font-size: 12pt;"><span>    </span>产品的主要位置</span></div><div><br/></div><div><br/></div><div style="text-align: center;"><img src="Zookeeper_files/Image.png" type="image/png" data-filename="Image.png" width="474"/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">结构</span></div><div style="margin-left: 40px;">        ZooKeeper集群中的节点分为三种角色：Leader、Follower和Observer，其结构和相互关系如图1所示。通常来说，需要在集群中配置奇数个（2N+1）ZooKeeper服务，<span style="color: rgb(255, 122, 116);">至少（N+1）</span>个投票才能成功的执行写操作。（就是所说的容灾能力）</div><div style="text-align: center;"><img src="Zookeeper_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div style="text-align: center;"><br/></div><div style="text-align: center;"><br/></div><div style="text-align: center;"><br/></div><div style="text-align: left;"></div><ul style="text-align: left;"><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">集群由一组</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Server</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点组成，这一组</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Server</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点中存在一个角色为</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的节点，其他节点都为</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Follower</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">。当客户端</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Client</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">连接到</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">集群，并且执行写请求时，这些请求会被发送到</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点上，然后</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点上数据变更会同步到集群中其他的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Follower</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点。</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点在接收到数据变更请求后，首先将变更写入本地磁盘，以作恢复之用。当所有的写请求持久化到磁盘以后，才会将变更应用到内存中。</span></font></div></li><li><div><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">使用了一种自定义的原子消息协议（</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Atomic Broadcast</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;"> </span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Zab</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">协议），在消息层的这种原子特性，保证了整个协调系统中的节点数据或状态的一致性。</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Follower</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">基于这种消息协议能够保证本地的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">数据与</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点同步，然后基于本地的存储来独立地对外提供服务。</span></div></li><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: 华文细黑;">当一个</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点发生故障失效时，失败故障是快速响应的，消息层负责重新选择一个</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">，继续作为协调服务集群的中心，处理客户端写请求，并将</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">协调系统的数据变更同步（广播）到其他的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Follower</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点。</span></font></div></li></ul><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt;"><br/></span></div><div style="text-align: left;"><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">    Leader</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点在接收到数据变更请求后，先写磁盘再写内存。</span></font></div><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-size: 11pt;"><br/></span></div><div style="text-align: left;"><span style="font-family: 黑体; font-weight: bold;"><font style="font-size: 14pt;">日志增强</font></span></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><span style="font-weight: bold;"><font style="font-size: 14pt;">Zookeeper关键特性：</font></span></div><div style="text-align: left;">   </div><div style="text-align: left;"><br/></div><div style="text-align: left;"> 一致性：对外展示同一个视图（内容可能不一样））</div><div style="text-align: left;">    实时性 ：保证实时收到服务器更新的信息（失效的或者更新的）</div><div style="text-align: left;">    可靠性：一个收到，转发给所有的Server</div><div style="text-align: left;">    等待无关性： <font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: 华文细黑;">慢的或者失效的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">client</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">不会干预快速的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">client</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的请求，使得每个</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">client</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">都能有效的等待</span></font></div><div style="text-align: left;"><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: 华文细黑;">    原子性：只有失败或者成功两种状态</span></font></div><div style="text-align: left;"><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: 华文细黑;">    顺序一致性：</span></font> <span style="font-size: 10pt; color: black; font-family: 华文细黑;">客户端所发送的更新会按照它们被发送的顺序进行应用</span></div><div><br/></div></div><div><br/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">Zookeeper读特性：</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">        任意节点的读操作效果都一样的（同一个视图下）</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><br/></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 14pt;"><span style="font-weight: bold;">Zookeeper写特性：</span></font></div><div style="text-align: center;"><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="Zookeeper_files/Image [2].png" type="image/png" data-filename="Image.png" width="381"/></span></span></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">    </span></font><span style="font-size: 11pt;">写请求</span></div><ul><ul><li><div style="text-align: left;">Follower或Observer接收到写请求后，转发给Leader。</div></li><li><div style="text-align: left;">Leader协调各Follower，通过投票机制决定是否接受该写请求。</div></li><li><div style="text-align: left;">如果超过半数以上的Leader、Follower节点返回写入成功，那么Leader提交该请求并返回成功，否则返回失败。</div></li><li><div style="text-align: left;">Follower或Observer返回写请求处理结果。</div></li></ul></ul><div style="text-align: left;"><span style="font-size: 11pt;">    只读请求</span></div><div style="text-align: left;">            客户端直接向Leader、Follower或Observer读取数据</div><div style="text-align: left;"><br/></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><font style="font-size: 14pt;"><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;">ZooKeeper</span><span style="font-family: 黑体; font-weight: bold;">客户端</span><span style="font-family: 黑体; font-weight: bold;">常用命令使用</span></font></div><div style="text-align: left;"><font style="font-size: 12pt;"><span style="font-size: 12pt;"><br/></span></font></div><div style="text-align: left;"><font style="font-size: 12pt;"><span style="font-size: 12pt;"><br/></span></font></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><font style="font-size: 16pt;"><span style="font-weight: bold;"><i>与组件之间的关系</i></span></font></div><div style="text-align: left;"><br/></div><div style="text-align: left;"><font><span style="font-size: 12pt; font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;">  </span> <font style="font-size: 14pt; color: rgb(70, 70, 70);"><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;"> ZooKeeper</span><span style="font-family: 黑体; font-weight: bold;">和</span><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;">Streaming</span></font></font></div><div>        </div></div><div style="text-align: center;">        <img src="Zookeeper_files/Image [3].png" type="image/png" data-filename="Image.png" width="397"/></div><div><br/></div><div><span style="font-size: 9pt;">注：</span></div><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Streaming</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">利用</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">实现</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">的主备。其中</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">提供了</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">2</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">种服务：</span></font></div></li><ul><li><div><span style="font-size: 9pt; color: black; font-family: 华文细黑;">分布式锁服务</span></div></li><ul><li><div><span style="font-size: 9pt; color: black; font-family: 华文细黑;">多个</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">进程都会尝试去</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">创建对应的节点，该节点只能被一个</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">进程创建成功，创建</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;"> </span> <span style="font-size: 9pt; color: black; font-family: 华文细黑;">成功的</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">进程成为主</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">。</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: 华文细黑;">事件侦听机制</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">—watcher</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: 华文细黑;">备</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">侦听对应的</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">节点。主</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">进程宕掉之后，该节点会被删除，那么，备</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Nimbus</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">就可以收到相应的消息。</span></font></div></li></ul></ul></ul><div><br/></div><div><br/></div><div>    </div><div><font style="color: rgb(70, 70, 70);"><span style="font-size: 12pt; font-weight: bold;"> </span><font><span style="font-size: 16pt; font-weight: bold;">   </span> <font style="font-size: 14pt;"><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;">ZooKeeper</span><span style="font-family: 黑体; font-weight: bold;">和</span><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;">HDFS</span></font></font></font></div><div>    </div><div style="text-align: center;"><img src="Zookeeper_files/Image [4].png" type="image/png" data-filename="Image.png" width="376"/></div><div><font style="font-size: 10pt;"><br/></font></div><ul><li><div><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZKFC</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">（</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZKFailoverController</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">）作为一个</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">集群的客户端，用来监控</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的状态信息</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZKFC</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">进程仅在部署</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的节点中存在。</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">HDFS</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">和</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点均有</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZKFC</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">进程</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">。</span></div></li><li><div><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">通过</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">感知</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的变化。一旦</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">宕机，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">HDFS</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">就会进行主备切换。</span></div></li><ul><li><div><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">HDFS</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZKFC</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">连接到</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">，把主机名等信息保存到</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">中，即“</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">/</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">hadoop</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">-ha</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">”下的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">znode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">目录里。先创建</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">znode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">目录的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">节点为主节点，另一个为备节点。</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">HDFS</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">通过</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">定时读取</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">信息。</span></div></li><li><div><span style="font-size: 10pt; color: black; font-family: 华文细黑;">当主节点进程异常结束时，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">HDFS</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">通过</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">感知“</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">/</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">hadoop</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">-ha</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">”目录下发生了变化，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">NameNode</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">会进行主备切换。</span></div></li><li><div><span style="color: black; font-family: 华文细黑; font-size: 10pt;">图中，实线为写入操作，虚线为监控操作。</span></div></li></ul></ul><div><br/></div><div><br/></div><div><font style="font-size: 14pt; color: rgb(70, 70, 70);"><span style="font-weight: bold; font-family: &quot;FrutigerNext LT Medium&quot;;">ZooKeeper</span><span style="font-weight: bold; font-family: 黑体;">和</span><span style="font-weight: bold; font-family: &quot;FrutigerNext LT Medium&quot;;">YARN</span></font></div><div>    </div></div><div style="text-align: center;"><img src="Zookeeper_files/Image [5].png" type="image/png" data-filename="Image.png" width="410"/></div><div><br/></div><div><font style="font-size: 10pt;"><br/></font></div><ul><li><div><span style="font-size: 10pt; color: black; font-family: 华文细黑;">在系统启动时，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">会尝试把选举信息写入</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">，第一个成功把写入</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">的</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">被选举为</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">，另一个为</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">。</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">定时去</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">监控</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">选举信息</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">。</span></div></li><li><div><span style="font-size: 10pt; color: black; font-family: 华文细黑;">一旦</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">异常结束，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Yarn</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">就会进行主备切换。</span></div></li><ul><li><div><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">还会在</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">中创建</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Statestore</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">目录，存储</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Application</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">相关信息。当</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">产生故障时，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Standby</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">会从</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Statestore</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">目录获取</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Application</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">相关信息，恢复数据</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">并升为</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Active</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">ResourceManager</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">。</span></div></li><li><div><span style="color: black; font-family: 华文细黑; font-size: 10pt;">图中，实线写入，虚线监控。</span></div></li></ul></ul><div><br/></div><div><br/></div><div><font style="font-size: 14pt; color: rgb(70, 70, 70);"><span style="font-weight: bold; font-family: &quot;FrutigerNext LT Medium&quot;;">ZooKeeper</span><span style="font-weight: bold; font-family: 黑体;">和</span><span style="font-weight: bold; font-family: &quot;FrutigerNext LT Medium&quot;;">HBase</span></font></div><div>            </div><div style="text-align: center;"><img src="Zookeeper_files/Image [6].png" type="image/png" data-filename="Image.png" width="314"/></div><div><br/></div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; font-family: 华文细黑;">要</span><span style="font-size: 10pt; font-family: 华文细黑;">存储</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HBase</span><span style="font-size: 10pt; font-family: 华文细黑;">元数据、</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HMaster</span><span style="font-size: 10pt; font-family: 华文细黑;">地址</span><span style="font-size: 10pt; font-family: 华文细黑;">，同时要接受</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HRegionServer</span><span style="font-size: 10pt; font-family: 华文细黑;">的注册</span><span style="font-size: 10pt; font-family: 华文细黑;">。</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HMaster</span><span style="font-size: 10pt; font-family: 华文细黑;">通过</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">ZooKeeper</span><span style="font-size: 10pt; font-family: 华文细黑;">感知各</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HRegionServer</span><span style="font-size: 10pt; font-family: 华文细黑;">的健康状况，以便进行控制管理</span><span style="font-size: 10pt; font-family: 华文细黑;">。</span></font></div></li><li><div><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HBase</span><span style="font-size: 10pt; font-family: 华文细黑;">可以部署多</span><span style="font-size: 10pt; font-family: 华文细黑;">对</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">Hmaster</span><span style="font-size: 10pt; font-family: 华文细黑;">实现</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HA</span><span style="font-size: 10pt; font-family: 华文细黑;">，</span><span style="font-size: 10pt; font-family: 华文细黑;">与</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HDFS HA</span> <span style="font-size: 10pt; font-family: 华文细黑;">类似。当出现</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">active</span> <span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HMaster</span> <span style="font-size: 10pt; font-family: 华文细黑;">宕机时，</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HBase</span><span style="font-size: 10pt; font-family: 华文细黑;">可立即实现主备切换。</span><span style="font-size: 10pt; font-family: 华文细黑;">避免</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HBase</span><span style="font-size: 10pt; font-family: 华文细黑;">单点故障问题</span><span style="font-size: 10pt; font-family: 华文细黑;">。</span></div></li><li><div><span style="font-size: 10pt; font-family: 华文细黑;">多对</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HMaster</span><span style="font-size: 10pt; font-family: 华文细黑;">是指启用</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HBase</span> <span style="font-size: 10pt; font-family: 华文细黑;">多实例（</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">HBase1,HBase2… …</span><span style="font-size: 10pt; font-family: 华文细黑;">）特性。</span></div></li><li><div><span style="font-family: 华文细黑; font-size: 10pt;">图中，实线写入，虚线监控。</span></div></li></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 