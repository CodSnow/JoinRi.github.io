<html>
<head>
  <title>Flume</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
    <link rel="stylesheet" type="text/css" href="../css/main.css" /> 
</head>
<body>
<h1>目录</h1>
<ul id="menu">
<li><a href="../notes/Saprk.html">Saprk</a></li>
<li><a href="../notes/HDFS.html">HDFS</a></li>
<li><a href="../notes/Flume.html">Flume</a></li>
<li><a href="../notes/Yarn.html">Yarn</a></li>
<li><a href="../notes/Zookeeper.html">Zookeeper</a></li>
<li><a href="../notes/HBase--分布式数据库.html">HBase</a></li>
<li><a href="../notes/Hive.html">Hive</a></li>
<li><a href="../notes/Loader.html">Loader</a></li>
<li><a href="../notes/Kafka.html">Kafka</a></li>
<li><a href="../notes/Flink.html">Flink</a></li>
</ul>
<br><br><br>
<a name="447"/>
<h1>Flume</h1>

<div>
<span><div><div><br/></div><div><span style="font-size: 12pt;"><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-size: 12pt; font-weight: bold;"><img src="Flume_files/Image.png" type="image/png" data-filename="Image.png" width="404"/></span></span></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-family: &quot;FrutigerNext LT Medium&quot;; font-weight: bold;">Flume是什么</span></font></div><div><span style="font-size: 12pt; font-family: &quot;FrutigerNext LT Medium&quot;;"> </span> <span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-size: 10pt;">  是一个</span><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-size: 10pt;">开源的,分布式，高可靠高可用的海量日志聚合的日志系统</span></div><div><span style="font-family: &quot;FrutigerNext LT Medium&quot;; font-size: 10pt;">    </span><span style="font-size: 10pt; font-family: 华文细黑;">用于收集数据；同时，</span><span style="font-size: 10pt; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; font-family: 华文细黑;">提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力。</span></div><div><span style="font-size: 10pt; font-family: 华文细黑;">    </span><span style="font-family: 华文细黑;">采用流式日志采集工具，对数据进行简单的处理写入</span></div><div><br/></div><ul><li><div><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">适用场景：应用系统产生的日志采集，采集后的数据供上层应用分析。</span></div></li><li><div><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">不适用场景：大量数据的实时数据采集（要求低延迟、高吞吐率）。</span></div></li><li><div><span style="font-size: 11pt; color: black; font-family: 华文细黑;">与其他开源日志收集工具</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">scribe</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">比较而言，几乎不用用户开发，</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">scribe</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">需要用户另外开发</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">client,</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">而</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">每一种数据源均有相应的</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">source</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">去读取或者接收数据。</span></div></li></ul><div><span style="font-size: 11pt;"><br/></span></div><div><span style="font-family: 华文细黑; font-size: 12pt;"><b>架构</b></span></div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">基础架构：</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">可以单节点直接采集数据，主要应用于集群内数据。</span></font></div></li></ul><div><span style="font-family: 华文细黑;">            </span><span style="font-family: 华文细黑;"><img src="Flume_files/Image [1].png" type="image/png" data-filename="Image.png" width="339"/></span></div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">多</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">agent</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">架构：</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">可以将多个节点连接起来，将最初的数据源经过收集，存储到最终的存储系统中。主要应用于集群外的数据导入到集群内。</span></font></div></li></ul><div><span style="font-family: 华文细黑;"><img src="Flume_files/Image [2].png" type="image/png" data-filename="Image.png" width="397"/></span></div><div><br/></div><div><span style="font-family: 华文细黑;"><img src="Flume_files/Image [3].png" type="image/png" data-filename="Image.png" width="444"/></span></div><div><br/></div><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Source:</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">数据源，即是产生日志信息的源头，</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">会将原始数据建模抽象成自己处理的数据对象：</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">event</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Channel Processor:</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">通道处理器，主要作用是将</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">source</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">发过来的数据放入通道（</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">）中。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Interceptor</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">：拦截器，主要作用是将采集到的数据根据用户的配置进行过滤、修饰。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Channel Selector</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">：通道选择器 ，主要作用是根据用户配置将数据放到不同的通道</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">）中。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Channel:</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">通道，主要作用是临时缓存数据。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Sink Runner: Sink</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">运行器，主要作用是通过它来驱动</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Sink Processor, Sink Processor</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">驱动</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">sink</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">来从</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">中取数据。</span></font></div></li><li><div><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Sink</span> <span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Processor:sink</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">处理器，它主要是根据配置使用不同的策略驱动</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">sink</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">从</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">中取数据，目前策略有：负载均衡、故障转移、直通。</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Sink:</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">主要作用是从</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">中取出数据并将数据放到不同的目的地。</span></font></div></li><li><div><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">event</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">：一个数据单元，带有一个可选的消息头，</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span> <span style="font-size: 9pt; color: black; font-family: 华文细黑;">传输的数据的基本单位是</span> <span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">event</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">，如果是文本文件，通常是一行记录，这也是事务的基本单位。</span></div></li><li><div><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Event</span> <span style="font-size: 9pt; color: black; font-family: 华文细黑;">从</span> <span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Source</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">，流向</span> <span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Channel</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">，再到</span> <span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Sink</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">，</span><span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">event</span><span style="font-size: 9pt; color: black; font-family: 华文细黑;">本身为一个</span> <span style="font-size: 9pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">byte</span> <span style="font-size: 9pt; color: black; font-family: 华文细黑;">数组，并可携带</span> <span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">headers</span> <span style="font-size: 11pt; color: black; font-family: 华文细黑;">信息。</span></div></li><li><div><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">event</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">代表着一个数据流的最小完整单元，从外部数据源来，流向最终目的。</span></div></li></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-family: 华文细黑; font-weight: bold; font-size: 12pt;">Flume Agent由Source、Channel、Sink组成，如图1所示，模块说明如表1所示。</span></div><div><br/></div><div style="text-align: center;"><span style="font-family: 华文细黑;"><img src="Flume_files/Image [4].png" type="image/png" data-filename="Image.png"/></span></div><div style="text-align: center;"><span style="font-family: 华文细黑;">图1 Flume结构图1</span></div><div style="text-align: center;"></div><div style="text-align: left;"><span style="font-family: 华文细黑;"><img src="Flume_files/Image [5].png" type="image/png" data-filename="Image.png"/></span></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-family: 华文细黑; font-weight: bold;">Flume也可以配置成多个Source、Channel、Sink，如图2所示：</span></div><div style="text-align: left;"></div><div style="text-align: center;"><span style="font-family: 华文细黑;"><img src="Flume_files/Image [6].png" type="image/png" data-filename="Image.png" width="453"/></span></div><div style="text-align: center;"><span style="font-family: 华文细黑;">图2 Flume结构图2</span></div><div><br/></div><div><br/></div><div><span style="font-family: 华文细黑; font-weight: bold; font-size: 12pt;">Flume还支持多个Flume Agent级联，如图3所示。</span></div><div style="text-align: center;"><span style="font-family: 华文细黑;"><img src="Flume_files/Image [7].png" type="image/png" data-filename="Image.png"/></span></div><div style="text-align: center;"><span style="font-family: 华文细黑;">图3 Flume级联结构图</span></div><div><br/></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold; font-family: &quot;FrutigerNext LT Medium&quot;;">Flume</span><span style="font-size: 12pt; font-weight: bold; font-family: 黑体;">级联消息压缩、加密</span></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;"><span>    </span><span>    </span>Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">级联节点之间的数据传输支持压缩和加密，提升数据传输效率和安全性。</span></font></div><div><br/></div><div><br/></div><div><span style="font-family: 华文细黑;">    </span></div><div><font style="font-size: 12pt;"><span style="font-family: 华文细黑; font-size: 12pt; font-weight: bold;">Flume数据监控</span></font></div><div><span style="font-family: 华文细黑; font-size: 12pt;">    </span><span style="font-size: 12pt; font-family: 华文细黑;"><img src="Flume_files/Image [8].png" type="image/png" data-filename="Image.png" width="374"/></span></div><div><span style="font-size: 12pt;"><span style="font-family: 华文细黑; font-size: 12pt; font-weight: bold;">传输可靠性:</span></span></div><div><span style="font-size: 12pt;"><span style="font-family: 华文细黑; font-size: 12pt; font-weight: bold;"><img src="Flume_files/Image [9].png" type="image/png" data-filename="Image.png" width="350"/></span></span></div><ol><li><div><span style="font-family: 华文细黑; font-size: 10pt;">Flume采用基于Transactions的方式保证数据传输的可靠性，当数据从一个Agent流向另外一个Agent时，两个Transactions已经开始生效。发送Agent的Sink首先从Channel取出一条消息，并且将该消息发送给另外一个Agent。如果接受消息的Agent成功地接受并处理消息，那么发送Agent将会提交Transactions，标识一次数据传输成功可靠地完成。</span></div></li><li><div><span style="font-family: 华文细黑; font-size: 10pt;">当接收Agent接受到发送Agent发送的消息时，开始一个新的Transactions，当该数据被成功处理（写入Channel中），那么接收Agent提交该Transactions，并向发送Agent发送成功响应。</span></div></li><li><div><span style="font-family: 华文细黑; font-size: 10pt;">如果在某次提交（commit）之前，数据传输出现了失败，将会再次开始上一次Transcriptions，并将上次发送失败的数据重新传输。因为commit操作已经将Transcriptions写入了磁盘，那么在进程故障退出并恢复业务之后，仍然可以继续上次的Transcriptions。</span></div></li></ol><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">在传输数据过程中，采用事务管理方式，保证传输过程中数据不会丢失，增强了数据传输的可靠性，同时缓存在</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">中的数据如果采用</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">file channel</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">，进程或者节点重启数据不会丢失。</span></font><span style="font-family: 华文细黑;">(</span><span style="font-size: 11pt; font-family: 华文细黑;">及事件采集或发送失败，会重新采集或发送</span><span style="font-family: 华文细黑;">)</span></div></li></ul><div><span style="font-size: 12pt;"><span style="font-family: 华文细黑; font-size: 12pt; font-weight: bold;">传输过程数据过滤</span></span></div><div><span style="font-size: 12pt; font-family: 华文细黑;">    </span><span style="font-size: 12pt; font-family: 华文细黑;"><img src="Flume_files/Image [10].png" type="image/png" data-filename="Image.png" width="489"/></span></div><div><span style="font-size: 12pt; font-family: 华文细黑;">    </span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">在传输数据过程中，可以简单的对数据简单过滤、清洗，可以去掉不关心的数据，同时如果需要对复杂的数据过滤，需要用户根据自己的数据特殊性，开发过滤插件，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">支持第三方过滤插件调用</span> <span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">在传输数据过程中，可以简单的对数据简单过滤、清洗，可以去掉不关心的数据，同时如果需要对复杂的数据过滤，需要用户根据自己的数据特殊性，开发过滤插件，</span><span style="font-size: 10pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Flume</span><span style="font-size: 10pt; color: black; font-family: 华文细黑;">支持第三方过滤插件调用</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: black; font-family: 华文细黑;">            注：</span></font></div><ul><ul><ul><li><div><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Inteceptor</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">:</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">过滤器，可以对数据过滤。</span></div></li><li><div><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Channel selector:</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">通道选择器，可以根据事件将数据发到不同的</span><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">channel</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">中，实现数据路由功能。</span></div></li><li><div><span style="font-size: 11pt; color: black; font-family: &quot;FrutigerNext LT Regular&quot;;">Source</span><span style="font-size: 11pt; color: black; font-family: 华文细黑;">端配置可增加正则匹配过滤。</span></div></li></ul></ul></ul><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 