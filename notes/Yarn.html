<html>
<head>
  <title>Yarn</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a href="../index.html">首页</a>
<a name="475"/>
<h1>Yarn</h1>

<div>
<span><div><div><span style="font-size: 12pt; font-weight: bold;">简介</span></div><ul><ul><li><div>YARN是Hadoop2.0中的资源管理系统，是一个通用的资源管理模块，可以为各类应用程序进行资源管理和调度。YARN并不局限于MapReduce，也可以供其他框架使用，比如Tez、Spark、Storm等。YARN类似于资源管理系统Mesos和更早的Torque。</div></li><li><div>在最早的Hadoop MapReduce计算架构中，进行作业调度时使用FIFO Scheduler。FIFO是指，所有用户的作业都被提交到一个队列中，然后按照作业的优先级，再按照作业提交时间的先后顺序选择将被执行的作业。Hadoop中只有一个作业队列，被提交的作业按照先后顺序在作业队列中排队，新来的作业插入到队尾。一个作业运行完成后，总是从队首取下一个作业运行。这种调度策略的优点是简单、易于实现，同时也减轻了JobTracker的负担。缺点是，它没有考虑到作业的紧迫程度，另外对小作业的运行不利。因此，逐渐衍生出可以分配资源的Superior Scheduler和Capacity Scheduler。</div></li></ul></ul><div><br/></div><div><span style="color: rgb(129, 182, 255);"><br/></span></div><div><span style="font-size: 12pt; font-weight: bold;">结构</span></div><div>    YARN模型主要由ResourceManager、ApplicationMaster和NodeManager组成，如下图1所示</div><div><br/></div><div><br/></div><div><br/></div><div style="text-align: center;"><img src="Yarn_files/Image.png" type="image/png" data-filename="Image.png" width="470"/></div><div style="text-align: center;"><br/></div><div style="text-align: center;"><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 135px;"></col><col style="width: 797px;"></col></colgroup><tbody><tr><td style="width: 135px; padding: 8px; border: 1px solid;"><div style="text-align: left;">client</div></td><td style="width: 797px; padding: 8px; border: 1px solid;"><div style="text-align: left;">YARN Application客户端，用户可以通过客户端向ResourceManager提交任务，查询Application运行状态等。</div></td></tr><tr><td style="width: 135px; padding: 8px; border: 1px solid;"><div style="text-align: left;">RourceManage</div></td><td style="width: 797px; padding: 8px; border: 1px solid;"><div style="text-align: left;">负责集群中所有资源的统一管理和分配。接收来自各个节点（NodeManager）的资源汇报信息，并根据收集的资源按照一定的策略分配给各个应用程序。</div></td></tr><tr><td style="width: 135px; padding: 8px; border: 1px solid;"><div style="text-align: left;">NameNode</div></td><td style="width: 797px; padding: 8px; border: 1px solid;"><div style="text-align: left;">NodeManager（NM）是YARN中每个节点上的代理，管理Hadoop集群中单个计算节点，包括与ResourceManger保持通信，监督Container的生命周期管理，监控每个Container的资源使用（内存、CPU等）情况，追踪节点健康状况，管理日志和不同应用程序用到的附属服务（auxiliary service）。</div></td></tr><tr><td style="width: 135px; padding: 8px; border: 1px solid;"><div style="text-align: left;">ApplicationMaster</div></td><td style="width: 797px; padding: 8px; border: 1px solid;"><div style="text-align: left;">即图中的App Mstr，负责一个Application生命周期内的所有工作。包括：与RM调度器协商以获取资源；将得到的资源进一步分配给内部任务（资源的二次分配）；与NM通信以启动/停止任务；监控所有任务运行状态，并在任务运行失败时重新为任务申请资源以重启任务。</div></td></tr><tr><td style="width: 135px; padding: 8px; border: 1px solid;"><div style="text-align: left;">Container</div></td><td style="width: 797px; padding: 8px; border: 1px solid;"><div style="text-align: left;">Container是YARN中的资源抽象，封装了某个节点上的多维度资源，如内存、CPU、磁盘、网络等（目前仅封装内存和CPU），当AM向RM申请资源时，RM为AM返回的资源便是用Container表示。YARN会为每个任务分配一个Container，且该任务只能使用该Container中描述的资源。</div></td></tr></tbody></table><div><br/></div></div><div><br/></div><ul><li><div>在YARN中，资源调度器是以层级队列方式组织资源的，这种组织方式有利于资源在不同队列间分配和共享，进而提高集群资源利用率。如下图所示，Superior Scheduler和Capacity Scheduler的核心资源分配模型相同。</div></li><li><div>调度器会维护队列的信息。用户可以向一个或者多个队列提交应用。每次NM心跳的时候，调度器会根据一定规则选择一个队列，再选择队列上的一个应用，并尝试在这个应用上分配资源。若因参数限制导致分配失败，将选择下一个应用。选择一个应用后，调度器会处理此应用的资源申请。其优先级从高到低依次为：本地资源的申请、同机架的申请，任意机器的申请。</div></li></ul><div><span style="font-size: 12pt; font-weight: bold;">原理</span></div><div>    新的Hadoop MapReduce框架被命名为MRv2或YARN。YARN主要包括ResourceManager、ApplicationMaster与NodeManager三个部分。<span style="color: rgb(129, 182, 255);">MRV1 能只能给mapreduce提供服务</span></div><ul><li><div>ResourceManager：RM是一个全局的资源管理器，负责整个系统的资源管理和分配。主要由两个组件构成：调度器（Scheduler）和应用程序管理器（Applications Manager）。</div></li><ul><li><div>调度器根据容量、队列等限制条件（如每个队列分配一定的资源，最多执行一定数量的作业等），将系统中的资源分配给各个正在运行的应用程序。调度器仅根据各个应用程序的资源需求进行资源分配，而资源分配单位用一个抽象概念Container表示。Container是一个动态资源分配单位，将内存、CPU、磁盘、网络等资源封装在一起，从而限定每个任务使用的资源量。此外，该调度器是一个可插拔的组件，用户可根据自己的需要设计新的调度器，YARN提供了多种直接可用的调度器，比如Fair Scheduler和Capacity Scheduler等。</div></li><li><div>应用程序管理器负责管理整个系统中所有应用程序，包括应用程序提交、与调度器协商资源以启动ApplicationMaster、监控ApplicationMaster运行状态并在失败时重新启动等。</div></li></ul><li><div>NodeManager：NM是每个节点上的资源和任务管理器，一方面，会定时向RM汇报本节点上的资源使用情况和各个                        Container的运行状态；另一方面，接收并处理来自AM的Container启动/停止等请求。</div></li><li><div>ApplicationMaster：AM负责一个Application生命周期内的所有工作。包括：</div></li><ul><li><div>与RM调度器协商以获取资源。</div></li><li><div>将得到的资源进一步分配给内部的任务(资源的二次分配)。</div></li><li><div>与NM通信以启动/停止任务。</div></li><li><div> 监控所有任务运行状态，并在任务运行失败时重新为任务申请资源以重启任务。</div></li></ul></ul><div><br/></div></div><div><br/></div></span>
</div>
<a href="../index.html">返回首页</a>
</body></html> 